<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="android,java,blog,code" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="￥.￥">
<meta property="og:type" content="website">
<meta property="og:title" content="Duan">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Duan">
<meta property="og:description" content="￥.￥">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Duan">
<meta name="twitter:description" content="￥.￥">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Duan</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Duan</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">The more hard, the more fortunate.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/16/Android - 带阴影点击效果，可自定义属性的媒体播放控制按钮(播放、暂停、下一曲、上一曲)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="James Duan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Duan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/16/Android - 带阴影点击效果，可自定义属性的媒体播放控制按钮(播放、暂停、下一曲、上一曲)/" itemprop="url">Android - 带阴影点击效果，可自定义属性的媒体播放控制按钮(播放、暂停、下一曲、上一曲)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-16T22:02:13+08:00">
                2017-06-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/06/16/Android - 带阴影点击效果，可自定义属性的媒体播放控制按钮(播放、暂停、下一曲、上一曲)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/16/Android - 带阴影点击效果，可自定义属性的媒体播放控制按钮(播放、暂停、下一曲、上一曲)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Android-带阴影点击效果，可自定义属性的媒体播放控制按钮-播放、暂停、下一曲、上一曲"><a href="#Android-带阴影点击效果，可自定义属性的媒体播放控制按钮-播放、暂停、下一曲、上一曲" class="headerlink" title="Android - 带阴影点击效果，可自定义属性的媒体播放控制按钮(播放、暂停、下一曲、上一曲)"></a>Android - 带阴影点击效果，可自定义属性的媒体播放控制按钮(播放、暂停、下一曲、上一曲)</h4><blockquote>
<p>自定义 View 开发的可定制大小，颜色，圆角，阴影半径，描边风格，点击时有”荧光“效果的播放(暂停)，上一曲(下一曲)按钮。</p>
</blockquote>
<p>demo 已上传 GitHub ，欢迎下载使用，有问题可以给我留言。<br>仓库地址：<br><a href="https://github.com/DuanJiaNing/MediaView" target="_blank" rel="external">DuanJiaNing/MediaView</a></p>
<h4 id="一-开发背景"><a href="#一-开发背景" class="headerlink" title="一.开发背景"></a>一.开发背景</h4><p>网易云音乐的很多按钮控件点击时都是带阴影效果的，不同于 material design 的涟漪效果，按钮被点击时图标轮廓四周会有白色“阴影”， 或者可以称为“荧光”效果，直接使用图标虽然可以达到同样的效果，但毕竟不灵活，可定制属性较少，于是，不如自己写一个。</p>
<h4 id="二-效果图"><a href="#二-效果图" class="headerlink" title="二.效果图"></a>二.效果图</h4><table align="center"><br><tr><br><th align="center">静态图</th><br><th align="center">动态图</th><br></tr><br><tr><br><td width="350"><img src="https://raw.githubusercontent.com/DuanJiaNing/MediaView/master/screenshort1.png"></td><br><td width="350"><img src="https://raw.githubusercontent.com/DuanJiaNing/MediaView/master/screenshort.gif"></td><br></tr><br></table>

<h4 id="三-介绍"><a href="#三-介绍" class="headerlink" title="三.介绍"></a>三.介绍</h4><blockquote>
<p>控件具有如下继承结构<br>|– android.view.View<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|– abstract MediaView<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|– SkipView    上一曲(下一曲)按钮<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|– PlayView     播放按钮</p>
<h5 id="3-1-构成元素"><a href="#3-1-构成元素" class="headerlink" title="3.1 构成元素"></a>3.1 构成元素</h5></blockquote>
<p>xml 中提供的可定制属性如下：</p>
<ul>
<li>radius 半径：整个控件的半径</li>
<li>shadowRadius 阴影半径</li>
</ul>
<p>（1） 外圆圈</p>
<ul>
<li>strokeWidth 描边宽度</li>
<li>strokeColor 描边颜色</li>
</ul>
<p>（2） 上一曲(下一曲)按钮：</p>
<ul>
<li>distance 单竖线和三角形顶点距离</li>
</ul>
<p>1 单竖线：</p>
<ul>
<li>innerLineWidth(Height) 宽度，高度：任一者赋值为 0 时不进行绘制。</li>
<li>innerLineRadius 圆角大小</li>
</ul>
<p>2 等腰三角形：</p>
<ul>
<li>triangleWidth 三角形顶角到底边的距离</li>
<li>triangleHeight 底边高度</li>
<li>triangleColor 填充颜色</li>
<li>triangleRadius 圆角大小</li>
<li>triangleHollow 是否空心</li>
<li>triangleStroke 空心时的描边宽度</li>
</ul>
<p>（3） 播放，暂停按钮</p>
<ul>
<li>checked 是否播放，true 为正在播放（此时处于可暂停状态）</li>
</ul>
<p>1 播放状态：<br>播放状态下直接绘制继承自 SkipView 的等腰三角形</p>
<p>2 暂停状态：此时两条竖线的属性时完全一致的</p>
<ul>
<li>pauseLineDistance 双竖线间距</li>
<li>pauseLineWidth 竖线宽度</li>
<li>pauseLineHeight 竖线高度</li>
<li>pauseLineRadius 竖线圆角</li>
<li>pauseLineColor 竖线颜色</li>
<li>pauseLineHollow 是否空心</li>
<li>pauseLineStroke 空心状态下指定竖线描边宽度</li>
</ul>
<p><img src="https://raw.githubusercontent.com/DuanJiaNing/MediaView/master/anyic1.jpg" alt=""></p>
<h4 id="四-具体实现"><a href="#四-具体实现" class="headerlink" title="四. 具体实现"></a>四. 具体实现</h4><h5 id="4-1-MediaView"><a href="#4-1-MediaView" class="headerlink" title="4.1 MediaView"></a>4.1 MediaView</h5><p>该类的完整定义如下：<br><code>public abstract class MediaView extends View implements ValueAnimator.AnimatorUpdateListener</code><br>将媒体控件共有的特性提取出来写在这个类中，共有特性有：<br>1 控件中心所在位置。<br>2 控件中心作为圆心，向外延展的半径。<br>3 圆圈的描边宽度<br>4 触摸动画的执行：有两个动画，手指触摸到控件时阴影由无到有的动画，手指离开屏幕时阴影从有到无。</p>
<h6 id="onMeasure-方法"><a href="#onMeasure-方法" class="headerlink" title="onMeasure 方法"></a>onMeasure 方法</h6><p>在该方法中计算出控件的宽高，以及半径。<br>注意：当 xml 中指定控件的宽高为具体值（math_parent 或 具体值）时控件的半径依照如下规则计算，此时在 xml 中指定的半径将失效：</p>
<p>控件宽高分别减去上下 padding 和左右 padding 后值小的一方减去阴影半径和圆圈描边之和的两倍除以 2（哈哈 还不如直接看代码！）。<br>对应代码为：<code>radius = (Math.min(width - wp, height - hp) - t) / 2;</code></p>
<p>当宽高都为 warp_content 时，xml 中指定的半径有效，此时控件高宽计算方式如下：<br><code>width = radius * 2 + t + wp;</code><br><code>height = radius * 2 + t + hp;</code><br>此时要考虑的因素有直径，阴影直径，两侧描边之后以及上下 padding(左右 padding)。<br>以高为例：高为半径的 2 倍加上阴影半径和描边宽度和的两倍加上上下侧的 padding 。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> widthMode = MeasureSpec.getMode(widthMeasureSpec);</div><div class="line">    <span class="keyword">int</span> widthSize = MeasureSpec.getSize(widthMeasureSpec);</div><div class="line">    <span class="keyword">int</span> heightMode = MeasureSpec.getMode(heightMeasureSpec);</div><div class="line">    <span class="keyword">int</span> heightSize = MeasureSpec.getSize(heightMeasureSpec);</div><div class="line">    <span class="keyword">int</span> width;</div><div class="line">    <span class="keyword">int</span> height;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> t = (shadowRadius + strokeWidth) * <span class="number">2</span>;</div><div class="line">    <span class="keyword">int</span> wp = getPaddingLeft() + getPaddingRight();</div><div class="line">    <span class="keyword">int</span> hp = getPaddingTop() + getPaddingBottom();</div><div class="line"></div><div class="line">    <span class="keyword">int</span> te = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span> (widthMode == MeasureSpec.EXACTLY) &#123;</div><div class="line">        width = widthSize;</div><div class="line">        te = <span class="number">0</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">//xml中宽度设为warp_content</span></div><div class="line">        width = radius * <span class="number">2</span> + t + wp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (heightMode == MeasureSpec.EXACTLY) &#123;</div><div class="line">        height = heightSize;</div><div class="line">        te = <span class="number">0</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        height = radius * <span class="number">2</span> + t + hp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN) &#123;</div><div class="line">        width = Math.max(width, getMinimumWidth());</div><div class="line">        height = Math.max(height, getMinimumHeight());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    setMeasuredDimension(width, height);</div><div class="line"></div><div class="line">    <span class="comment">//长宽任一者指定具体长度（EXACTLY）时，xml 中设置的 radius 失效</span></div><div class="line">    <span class="keyword">if</span> (te != -<span class="number">1</span>)</div><div class="line">        radius = (Math.min(width - wp, height - hp) - t) / <span class="number">2</span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h6 id="onLayout-方法"><a href="#onLayout-方法" class="headerlink" title="onLayout 方法"></a>onLayout 方法</h6><p>在 onLayout 方法中确定圆心，注意 getWidth getHeight 只有在 onMeasure 方法执行完之后才能正确获得值，确定规则如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">centerX = getPaddingLeft() + (getWidth() - getPaddingLeft() - getPaddingRight()) / <span class="number">2</span>;</div><div class="line"> centerY = getPaddingTop() + (getHeight() - getPaddingTop() - getPaddingBottom()) / <span class="number">2</span>;</div></pre></td></tr></table></figure></p>
<h6 id="onTouchEvent-方法"><a href="#onTouchEvent-方法" class="headerlink" title="onTouchEvent 方法"></a>onTouchEvent 方法</h6><p>覆写该方法控制触摸动画的执行，点击事件监听。<br>注意：当<strong>收到 ACTION_DOWN 事件之后，先调用父类的 onTouchEvent 方法，然后再返回 true 。</strong></p>
<p>这样做的原因是：在收到 ACTION_DOWN 事件后启动触摸动画（阴影从无到有），在 ACTION_UP 事件到达时恢复（启动释放动画，阴影从有到无），既然需要 ACTION_UP 事件，意味着必须处理  ACTION_DOWN  事件（收到 ACTION_DOWN  时返回 true ，如果返回 false ，那后续的事件就不会传到该控件，也就收不到 ACTION_UP 事件）。</p>
<p>事件分发机制可参看我的另一篇文章：<a href="http://blog.csdn.net/aimeimeits/article/details/71512627" target="_blank" rel="external">Android-View的事件分发机制</a><br>但这样有个问题，返回 true 意味着我（该控件）对系统宣布：此次事件序列接下来发生的所有事件都交给我处理，那点击事件呢？长按事件呢？返回 true 后系统也就不再帮你决定何时触发点击事件了，即点击事件的触发也由你自己决定，但我不想自己控制点击事件的触发时机（有些麻烦），该怎么办呢？</p>
<p>ACTION_DOWN 事件返回 true 前的<code>super.onTouchEvent(event);</code>就可以解决这个问题，在ACTION_UP 到达时也要调用<code>super.onTouchEvent(event);</code>，这样系统仍将帮你处理点击事件。即在外面为控件绑定点击事件监听时能正常回调。<br>原因：<br>View 的点击事件在 ACTION_DOWN 到达时开始，系统会启动一个计时器，长按到一定时间后系统会触发 onLongClick 事件，快速单击时直接触发 onClick 事件，这个过程是在 ACTION_DOWN  时开始，在 ACTION_UP 时决策是否触发点击事件，在 ACTION_DOWN   和  ACTION_UP 之间决策是否触发长按事件。因此在 ACTION_DOWN    和 ACTION_UP 到达时到调用 View 的 onTouchEvent 方法以完成点击，长按事件触发控制。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">       <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">           <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">               startPreAnim();</div><div class="line">               <span class="comment">//调用 View 的事件监听以使用 View 的 click 和 longClick 监听</span></div><div class="line">               <span class="keyword">super</span>.onTouchEvent(event);</div><div class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">           <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">               startReleaseAnim();</div><div class="line">               <span class="comment">//调用 View 的事件监听以使用 View 的 click 和 longClick 监听</span></div><div class="line">               <span class="keyword">super</span>.onTouchEvent(event);</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">default</span>:</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<h6 id="onDraw-方法"><a href="#onDraw-方法" class="headerlink" title="onDraw 方法"></a>onDraw 方法</h6><p>该方法以 final 的形式被覆写，这意味着任何继承于 MediaView 的控件都无法覆盖该方法，这主要是为了限制 MediaView  子类控件的UI风格，如果子类重写了 onDraw 方法，那何不直接继承 View，定义一个全新的控件。</p>
<p><code>isCreate</code>变量用于标识是否为第一次绘制，控件阴影初始时并不是 0 ，如果直接绘制，会把阴影也绘制出来，所以第一次绘制时不绘制阴影，之后的重绘（主要是动画时）由动画控制阴影的大小。<br>在调用<code>setShadowRadius</code>方法设置阴影大小时，修改阴影的同时将更新属性动画的参数。</p>
<p><code>paint.setMaskFilter(new BlurMaskFilter(sd, BlurMaskFilter.Blur.SOLID));</code><br>设置画笔绘制图形内容的同时绘制外阴影，不绘制内阴影。</p>
<p>通过 Paint 的<code>setMaskFilter</code>方法设置阴影大小，注意 <code>BlurMaskFilter</code>的构造方法第一个参数是浮点类型，且值必须为大于 0 ，因而无论是属性动画中或是 onDraw 方法中的局部变量<code>sd</code>，亦或<code>setShadowRadius</code>方法，阴影的最小值不会小于 1。</p>
<p>setMaskFilter  方法在开启硬件加速的情况下是无效的，因而要关闭硬件加速。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Android4.0（API14）之后硬件加速功能就被默认开启了,setMaskFilter 在开启硬件加速的情况下无效，需要关闭硬件加速</span></div><div class="line"><span class="keyword">this</span>.setLayerType(View.LAYER_TYPE_SOFTWARE, <span class="keyword">null</span>);</div></pre></td></tr></table></figure></p>
<p>Paint 的<code>setMaskFilter</code>具体介绍请参考这里：<a href="http://blog.csdn.net/nimeghbia/article/details/48891557" target="_blank" rel="external">详解Paint的setMaskFilter(MaskFilter maskfilter)</a></p>
<p>先绘制圆圈，在绘制内部。drawInside 方法是抽象方法，由子类实现。<br><code>protected abstract void drawInside(Canvas canvas);</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line"></div><div class="line">    canvas.drawARGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="keyword">int</span> sd;</div><div class="line">    <span class="keyword">if</span> (isCreate) &#123;</div><div class="line">        <span class="comment">//第一次绘制时使阴影为0</span></div><div class="line">        <span class="comment">//之后重绘时由动画控制阴影的大小</span></div><div class="line">        sd = <span class="number">1</span>;</div><div class="line">        isCreate = <span class="keyword">false</span>;</div><div class="line">    &#125; <span class="keyword">else</span> sd = shadowRadius;</div><div class="line"></div><div class="line">    <span class="comment">//只绘制外阴影和图形内容本身，不绘制内阴影</span></div><div class="line">    paint.setMaskFilter(<span class="keyword">new</span> BlurMaskFilter(sd, BlurMaskFilter.Blur.SOLID));</div><div class="line"></div><div class="line">    drawOuter(canvas);</div><div class="line"></div><div class="line">    drawInside(canvas);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="4-2-SkipView"><a href="#4-2-SkipView" class="headerlink" title="4.2 SkipView"></a>4.2 SkipView</h5><p>类定义：<code>public class SkipView extends MediaView</code><br>该类完成【上一曲(下一曲)】控件的绘制。<br>该类继承了 MediaView 的属性和方法的同时又很多自己的属性，可以参看上面的 <a href="#">3.1 构成元素<br>（2） 上一曲(下一曲)按钮</a> 查看具体属性</p>
<h6 id="onLayout-方法-1"><a href="#onLayout-方法-1" class="headerlink" title="onLayout 方法"></a>onLayout 方法</h6><p><img src="https://raw.githubusercontent.com/DuanJiaNing/MediaView/master/anyic1.jpg" alt=""></p>
<p>1 在 onLayout 方法中检查【单竖线】的高宽是否小于等于 0，如果任一者赋值为 0，就将两者赋为 0，这样在绘制时就不会绘制单竖线了。</p>
<p>2 如果三角形的高（底边的长度）小于或等于 0 （这可能是因为 xml 中赋值错误，或没有赋值（SkipView 的构造方法中将底边的长度默认值设为 0），就将其赋为半径的 2/3。</p>
<p><strong>下面提到的 顶点 指的都是等腰三角形 顶角 所在的顶点。</strong></p>
<p>3 如果【三角形顶点与底边的距离】小于或等于 0 ，就将该等腰三角形作为等边三角形，计算出值。</p>
<p>4 三角形圆角的绘制使用的是 Path 的 cubicTo 方法，该方法需要指定三个点作为控制点绘制贝塞尔曲线。<br>据此计算出三角形上 9 个点的坐标，9 个点的坐标在图中第三个控件中有标明。计算时根据对称性可简化一些计算。</p>
<p>5 <em>很关键的计算过程建议直接看代码，参照注释理解。</em><br>因为计算的时候是假设【三角形顶点与底边连线】的中点与圆心重合进行计算的，所以 9 个点计算出来后需要进行平移，使三角形的【内心】与圆心重合。这里需要动手推一下平移距离计算公式，即让两点重合需要平移的距离。</p>
<ul>
<li>使两点重合平移（往前移）的距离：先计算出内心与顶点的距离，该距离减去【三角形顶角与底边连线】的一半。</li>
<li>两点重合之后还需要移动（往后移）【单竖线宽度】+【竖线与顶点间距】和的一半。原因是需要把【竖线+间距+三角形】整体移动到【圆圈】中心，这样内部整体才居中。</li>
</ul>
<p>移动时只需修改三角形 9 个顶点的横坐标即可，竖线的位置根据三角形顶点来确定，所以不用考虑。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</div><div class="line"></div><div class="line">       <span class="keyword">if</span> (innerLineHeight &lt;= <span class="number">0</span> || innerLineWidth &lt;= <span class="number">0</span>) &#123;</div><div class="line">           innerLineHeight = <span class="number">0</span>;</div><div class="line">           innerLineWidth = <span class="number">0</span>;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">if</span> (triangleHeight &lt;= <span class="number">0</span>)</div><div class="line">           triangleHeight = radius * <span class="number">2</span> / <span class="number">3</span>;</div><div class="line"></div><div class="line">       <span class="keyword">if</span> (triangleWidth &lt;= <span class="number">0</span>) &#123;</div><div class="line">           <span class="comment">//将三角形绘制成等边三角形</span></div><div class="line">           <span class="keyword">int</span> t2 = triangleHeight * triangleHeight;</div><div class="line">           triangleWidth = (<span class="keyword">int</span>) Math.sqrt(t2 - (t2 / <span class="number">4</span>));</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="comment">//赋值不合理，进行重置（这不是此控件预期的展现形式，应根据整体比例合理赋值）</span></div><div class="line">       <span class="comment">//只对上限进行处理</span></div><div class="line">       <span class="keyword">if</span> (innerLineHeight &gt;= radius * <span class="number">2</span>)</div><div class="line">           innerLineHeight = radius * <span class="number">2</span>;</div><div class="line">       <span class="keyword">if</span> (innerLineWidth &gt;= radius)</div><div class="line">           innerLineWidth = radius;</div><div class="line">       <span class="keyword">if</span> (triangleWidth &gt;= radius)</div><div class="line">           triangleWidth = radius;</div><div class="line">       <span class="keyword">if</span> (triangleHeight &gt; radius * <span class="number">2</span>)</div><div class="line">           triangleHeight = radius * <span class="number">2</span>;</div><div class="line"></div><div class="line">       <span class="comment">//以顶点作为参考</span></div><div class="line">       <span class="comment">//圆角导致的纵坐标迁移量</span></div><div class="line">       <span class="keyword">float</span> ry = triangleRadius / <span class="number">2</span>;</div><div class="line">       <span class="comment">//圆角导致的横坐标迁移量</span></div><div class="line">       <span class="keyword">float</span> rx = (<span class="keyword">float</span>) Math.sqrt(triangleRadius * triangleRadius - ry * ry);</div><div class="line"></div><div class="line">       <span class="comment">//计算三角形上 9 个点的坐标</span></div><div class="line">       <span class="comment">//拟使【三角形顶点与底边中点相连的线段的中点】在【圆心】上进行计算</span></div><div class="line">       <span class="comment">//计算时根据三角形在坐标轴上的位置关系简化计算</span></div><div class="line">       <span class="keyword">int</span> halfW = triangleWidth / <span class="number">2</span>;</div><div class="line">       coordinate[<span class="number">0</span>][<span class="number">0</span>] = centerX - halfW;</div><div class="line">       coordinate[<span class="number">0</span>][<span class="number">1</span>] = centerY;</div><div class="line">       coordinate[<span class="number">1</span>][<span class="number">0</span>] = (centerX - halfW) + rx;</div><div class="line">       coordinate[<span class="number">1</span>][<span class="number">1</span>] = centerY - ry;</div><div class="line">       coordinate[<span class="number">8</span>][<span class="number">0</span>] = coordinate[<span class="number">1</span>][<span class="number">0</span>];</div><div class="line">       coordinate[<span class="number">8</span>][<span class="number">1</span>] = centerY + ry;</div><div class="line"></div><div class="line">       coordinate[<span class="number">3</span>][<span class="number">0</span>] = centerX + halfW;</div><div class="line">       coordinate[<span class="number">3</span>][<span class="number">1</span>] = centerY - triangleHeight / <span class="number">2</span>;</div><div class="line">       coordinate[<span class="number">2</span>][<span class="number">0</span>] = (centerX + halfW) - rx;</div><div class="line">       coordinate[<span class="number">2</span>][<span class="number">1</span>] = centerY - (triangleHeight / <span class="number">2</span> - ry);</div><div class="line">       coordinate[<span class="number">7</span>][<span class="number">0</span>] = coordinate[<span class="number">2</span>][<span class="number">0</span>];</div><div class="line">       coordinate[<span class="number">7</span>][<span class="number">1</span>] = centerY + (triangleHeight / <span class="number">2</span> - ry);</div><div class="line"></div><div class="line">       coordinate[<span class="number">6</span>][<span class="number">0</span>] = coordinate[<span class="number">3</span>][<span class="number">0</span>];</div><div class="line">       coordinate[<span class="number">6</span>][<span class="number">1</span>] = centerY + triangleHeight / <span class="number">2</span>;</div><div class="line">       coordinate[<span class="number">4</span>][<span class="number">0</span>] = centerX + halfW;</div><div class="line">       coordinate[<span class="number">4</span>][<span class="number">1</span>] = centerY - (triangleHeight / <span class="number">2</span> - triangleRadius);</div><div class="line">       coordinate[<span class="number">5</span>][<span class="number">0</span>] = coordinate[<span class="number">4</span>][<span class="number">0</span>];</div><div class="line">       coordinate[<span class="number">5</span>][<span class="number">1</span>] = centerY + (triangleHeight / <span class="number">2</span> - triangleRadius);</div><div class="line"></div><div class="line">       <span class="comment">//平移三角形使其居中</span></div><div class="line">       <span class="comment">//平移之前【三角形顶点与底边中点相连的线段中点】与【圆心】重合，此时内部的【整体图形】没有在圆圈内【居中】</span></div><div class="line">       <span class="comment">//平移所有点使【三角形内心】与【圆心】重合</span></div><div class="line">       <span class="comment">// ** 计算【等边三角形内心与顶点的距离】</span></div><div class="line">       <span class="keyword">double</span> a2 = triangleWidth * triangleWidth;</div><div class="line">       <span class="keyword">double</span> c2 = triangleHeight * triangleHeight / <span class="number">4</span>;</div><div class="line">       <span class="keyword">double</span> c = triangleHeight / <span class="number">2</span>;</div><div class="line">       <span class="keyword">double</span> a = triangleWidth;</div><div class="line">       <span class="keyword">double</span> x = (Math.pow(Math.sqrt(a2 + c2) - c, <span class="number">2</span>) + a2) / (<span class="number">2</span> * a);</div><div class="line"></div><div class="line">       <span class="comment">//往前移动【三角形内心到圆心位置】，然后往后移动【竖线宽度】和【顶点到竖线距离】之和的一半</span></div><div class="line">       <span class="keyword">double</span> tr = (x - halfW) - (distance + innerLineWidth) / <span class="number">2</span>;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; coordinate.length; i++) &#123;</div><div class="line">           coordinate[i][<span class="number">0</span>] -= tr;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<h6 id="drawInside-方法"><a href="#drawInside-方法" class="headerlink" title="drawInside 方法"></a>drawInside 方法</h6><p>覆写 MediaView 的 drawInside 方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawInside</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    drawLine(canvas);</div><div class="line">    drawTriangle(canvas);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h6 id="drawLine-和-drawTriangle-方法"><a href="#drawLine-和-drawTriangle-方法" class="headerlink" title="drawLine 和 drawTriangle 方法"></a>drawLine 和 drawTriangle 方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 绘制单竖线</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawLine</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (innerLineHeight &lt;= <span class="number">0</span> || innerLineWidth &lt;= <span class="number">0</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line"></div><div class="line">    paint.setStyle(Paint.Style.FILL);</div><div class="line">    paint.setColor(triangleColor);</div><div class="line"></div><div class="line">    <span class="comment">//绘制竖线</span></div><div class="line">    <span class="comment">//参考三角形的 顶点 绘制</span></div><div class="line">    <span class="keyword">float</span> left = coordinate[<span class="number">0</span>][<span class="number">0</span>] - distance - innerLineWidth;</div><div class="line">    <span class="keyword">float</span> top = coordinate[<span class="number">0</span>][<span class="number">1</span>] - innerLineHeight / <span class="number">2</span>;</div><div class="line">    <span class="keyword">float</span> right = left + innerLineWidth;</div><div class="line">    <span class="keyword">float</span> bottom = top + innerLineHeight;</div><div class="line">    RectF rectF = <span class="keyword">new</span> RectF(left, top, right, bottom);</div><div class="line">    canvas.drawRoundRect(rectF, innerLineRadius, innerLineRadius, paint);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 绘制三角形</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawTriangle</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (triangleHollow) &#123;</div><div class="line">        paint.setStyle(Paint.Style.STROKE);</div><div class="line">        paint.setStrokeWidth(triangleStroke);</div><div class="line">    &#125; <span class="keyword">else</span></div><div class="line">        paint.setStyle(Paint.Style.FILL);</div><div class="line"></div><div class="line">    paint.setColor(triangleColor);</div><div class="line"></div><div class="line">    <span class="comment">//绘制三角形</span></div><div class="line">    <span class="comment">//顶点上的点及其两侧的点使用贝塞尔曲线连接，实现圆弧效果</span></div><div class="line">    Path path = <span class="keyword">new</span> Path();</div><div class="line">    path.moveTo(coordinate[<span class="number">1</span>][<span class="number">0</span>], coordinate[<span class="number">1</span>][<span class="number">1</span>]);</div><div class="line">    path.lineTo(coordinate[<span class="number">2</span>][<span class="number">0</span>], coordinate[<span class="number">2</span>][<span class="number">1</span>]);</div><div class="line">    path.cubicTo(coordinate[<span class="number">2</span>][<span class="number">0</span>], coordinate[<span class="number">2</span>][<span class="number">1</span>], coordinate[<span class="number">3</span>][<span class="number">0</span>], coordinate[<span class="number">3</span>][<span class="number">1</span>], coordinate[<span class="number">4</span>][<span class="number">0</span>], coordinate[<span class="number">4</span>][<span class="number">1</span>]);</div><div class="line">    path.lineTo(coordinate[<span class="number">5</span>][<span class="number">0</span>], coordinate[<span class="number">5</span>][<span class="number">1</span>]);</div><div class="line">    path.cubicTo(coordinate[<span class="number">5</span>][<span class="number">0</span>], coordinate[<span class="number">5</span>][<span class="number">1</span>], coordinate[<span class="number">6</span>][<span class="number">0</span>], coordinate[<span class="number">6</span>][<span class="number">1</span>], coordinate[<span class="number">7</span>][<span class="number">0</span>], coordinate[<span class="number">7</span>][<span class="number">1</span>]);</div><div class="line">    path.lineTo(coordinate[<span class="number">8</span>][<span class="number">0</span>], coordinate[<span class="number">8</span>][<span class="number">1</span>]);</div><div class="line">    path.cubicTo(coordinate[<span class="number">8</span>][<span class="number">0</span>], coordinate[<span class="number">8</span>][<span class="number">1</span>], coordinate[<span class="number">0</span>][<span class="number">0</span>], coordinate[<span class="number">0</span>][<span class="number">1</span>], coordinate[<span class="number">1</span>][<span class="number">0</span>], coordinate[<span class="number">1</span>][<span class="number">1</span>]);</div><div class="line">    path.close();</div><div class="line"></div><div class="line">    canvas.drawPath(path, paint);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="4-3-PlayView"><a href="#4-3-PlayView" class="headerlink" title="4.3 PlayView"></a>4.3 PlayView</h5><p>【播放(暂停)】按钮<br>类定义：<code>public class PlayView extends SkipView implements Checkable</code><br>该类继承了 SkipView 的属性和方法的同时又很多自己的属性，可以参看上面的 <a href="#">3.1 构成元素<br>（3） 播放，暂停按钮</a> 查看具体属性</p>
<h6 id="drawInside-方法-1"><a href="#drawInside-方法-1" class="headerlink" title="drawInside 方法"></a>drawInside 方法</h6><p>覆写了 SkipView 的 drawInside 方法<br>在【正在播放】状态下绘制双竖线，<code>drawLine</code> 方法也覆写了 SkipView 的方法。<br>在【没有播放】状态下直接调用父类的 <code>drawTriangle</code>方法绘制三角形。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawInside</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (isPlaying) &#123;</div><div class="line">        drawLine(canvas);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">super</span>.drawTriangle(canvas);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h6 id="onTouchEvent-方法-1"><a href="#onTouchEvent-方法-1" class="headerlink" title="onTouchEvent 方法"></a>onTouchEvent 方法</h6><p>覆写了父类的方法，但只修改了少部分，在 ACTION_UP 事件到达时反转当前状态。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">       <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">           <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">               startPreAnim();</div><div class="line">               <span class="comment">//调用 View 的事件监听以使用 View 的 click 和 longClick 监听</span></div><div class="line">               <span class="keyword">super</span>.onTouchEvent(event);</div><div class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">           <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">               startReleaseAnim();</div><div class="line">               <span class="comment">//状态反转</span></div><div class="line">               toggle();</div><div class="line">               <span class="comment">//调用 View 的事件监听以使用 View 的 click 和 longClick 监听</span></div><div class="line">               <span class="keyword">super</span>.onTouchEvent(event);</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">default</span>:</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<h6 id="toggle-方法"><a href="#toggle-方法" class="headerlink" title="toggle 方法"></a>toggle 方法</h6><p>该方法覆写自 <code>android.widget.Checkable</code>接口，反转当前选中状态。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//反转状态</span></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toggle</span><span class="params">()</span> </span>&#123;</div><div class="line">       isPlaying = !isPlaying;</div><div class="line">       <span class="keyword">if</span> (checkedChangeListener != <span class="keyword">null</span>)</div><div class="line">           checkedChangeListener.onCheckedChanged(<span class="keyword">this</span>, isPlaying);</div><div class="line">       invalidate();</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<h6 id="drawLine-方法"><a href="#drawLine-方法" class="headerlink" title="drawLine 方法"></a>drawLine 方法</h6><p>该方法中绘制 【播放状态】下的双竖线，绘制时需要以圆点为中心，在两侧绘制两条竖线，这样就能使两条竖线居中。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawLine</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (pauseLineHollow) &#123;</div><div class="line">        paint.setStyle(Paint.Style.STROKE);</div><div class="line">        paint.setStrokeWidth(pauseLineStroke);</div><div class="line">    &#125; <span class="keyword">else</span></div><div class="line">        paint.setStyle(Paint.Style.FILL);</div><div class="line"></div><div class="line">    paint.setColor(pauseLineColor);</div><div class="line"></div><div class="line">    <span class="comment">//绘制双竖线</span></div><div class="line">    <span class="keyword">float</span> left = centerX - pauseLineDistance / <span class="number">2</span> - pauseLineWidth;</div><div class="line">    <span class="keyword">float</span> top = centerY - pauseLineHeight / <span class="number">2</span>;</div><div class="line">    <span class="keyword">float</span> right = left + pauseLineWidth;</div><div class="line">    <span class="keyword">float</span> bottom = top + pauseLineHeight;</div><div class="line">    RectF rectF = <span class="keyword">new</span> RectF(left, top, right, bottom);</div><div class="line">    canvas.drawRoundRect(rectF, pauseLineRadius, pauseLineRadius, paint);</div><div class="line"></div><div class="line">    <span class="keyword">float</span> l = right + pauseLineDistance;</div><div class="line">    <span class="keyword">float</span> t = top;</div><div class="line">    <span class="keyword">float</span> r = l + pauseLineWidth;</div><div class="line">    <span class="keyword">float</span> b = bottom;</div><div class="line">    RectF rf = <span class="keyword">new</span> RectF(l, t, r, b);</div><div class="line">    canvas.drawRoundRect(rf, pauseLineRadius, pauseLineRadius, paint);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="五-如何使用"><a href="#五-如何使用" class="headerlink" title="五.如何使用"></a>五.如何使用</h4><h5 id="5-1-复制源文件"><a href="#5-1-复制源文件" class="headerlink" title="5.1 复制源文件"></a>5.1 复制源文件</h5><p>使用 【上一曲(下一曲)】和【播放，暂停】控件需复制 MediaView.java ， SkipView.java ， PlayView.java 和 attrs.xml 文件到你的项目中。</p>
<p>如果你只需要 【上一曲(下一曲)】对应的控件：<br>1 复制 MediaView.java 和 SkipView.java 到你的项目中<br>2 将 attrs 文件中的 <code>&lt;declare-styleable name=&quot;MediaView&quot;&gt;....&lt;/declare-styleable&gt;</code>及其对应的 attr 属性定义，<code>&lt;declare-styleable name=&quot;SkipView&quot;&gt;....&lt;/declare-styleable&gt;</code>及其对应的 attr 属性定义 复制到你项目中的 values 文件夹下的资源文件中。</p>
<h5 id="5-2-使用示例"><a href="#5-2-使用示例" class="headerlink" title="5.2 使用示例"></a>5.2 使用示例</h5><p>在完成 5.1 之后，需要 Rebuild Project ，然后就可以在你的项目中使用了。</p>
<p>可以在布局文件中直接使用：<br>使用时包名替换成你的源文件所在位置</p>
<p><strong>【上一曲(下一曲)】控件</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">com.duan.mediaviewdemo.view.SkipView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/sv_01"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_weight</span>=<span class="string">"0.5"</span></div><div class="line"></div><div class="line">    <span class="attr">app:innerLineHeight</span>=<span class="string">"30dp"</span></div><div class="line">    <span class="attr">app:innerLineWidth</span>=<span class="string">"6dp"</span></div><div class="line"></div><div class="line">    <span class="attr">app:innerLineRadius</span>=<span class="string">"8dp"</span></div><div class="line"></div><div class="line">    <span class="attr">app:distance</span>=<span class="string">"-8dp"</span></div><div class="line">    <span class="attr">app:triangleHeight</span>=<span class="string">"40dp"</span></div><div class="line"></div><div class="line">    <span class="attr">app:strokeWidth</span>=<span class="string">"0dp"</span></div><div class="line">    <span class="attr">app:triangleColor</span>=<span class="string">"#2ca4a4"</span></div><div class="line">    <span class="attr">app:triangleRadius</span>=<span class="string">"8dp"</span></div><div class="line"></div><div class="line">    /&gt;</div></pre></td></tr></table></figure></p>
<p><strong>【播放，暂停】控件</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">com.duan.mediaviewdemo.view.PlayView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line"></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_weight</span>=<span class="string">"0.5"</span></div><div class="line"></div><div class="line">      <span class="attr">android:rotation</span>=<span class="string">"180"</span></div><div class="line">      <span class="attr">app:checked</span>=<span class="string">"true"</span></div><div class="line">      <span class="attr">app:pauseLineDistance</span>=<span class="string">"8dp"</span></div><div class="line">      <span class="attr">app:pauseLineHeight</span>=<span class="string">"35dp"</span></div><div class="line"></div><div class="line">      <span class="attr">app:pauseLineHollow</span>=<span class="string">"true"</span></div><div class="line"></div><div class="line">      <span class="attr">app:pauseLineRadius</span>=<span class="string">"0dp"</span></div><div class="line">      <span class="attr">app:pauseLineWidth</span>=<span class="string">"10dp"</span></div><div class="line">      <span class="attr">app:strokeColor</span>=<span class="string">"#e4188f"</span></div><div class="line">      <span class="attr">app:triangleColor</span>=<span class="string">"#e4188f"</span></div><div class="line">      <span class="attr">app:strokeWidth</span>=<span class="string">"3dp"</span></div><div class="line">      <span class="attr">app:triangleHeight</span>=<span class="string">"35dp"</span></div><div class="line"></div><div class="line"></div><div class="line">      <span class="attr">app:triangleHollow</span>=<span class="string">"true"</span></div><div class="line">      <span class="attr">app:triangleRadius</span>=<span class="string">"5dp"</span></div><div class="line">      <span class="attr">app:triangleStroke</span>=<span class="string">"7dp"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p>在 java 中使用：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">    SkipView sv = (SkipView) findViewById(R.id.sv_01);</div><div class="line">    PlayView pv = (PlayView) findViewById(R.id.pv_01);</div><div class="line"></div><div class="line">    sv.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"click"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    pv.setOnCheckedChangeListener(<span class="keyword">new</span> PlayView.OnCheckedChangeListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheckedChanged</span><span class="params">(PlayView view, <span class="keyword">boolean</span> checked)</span> </span>&#123;</div><div class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"checked:"</span> + checked, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>代码有点多，说的也可能不清楚  (0.0)，不如直接看代码吧。demo 已上传 GitHub ，欢迎下载使用，有问题可以给我留言。<br>仓库地址：</p>
<center><a href="https://github.com/DuanJiaNing/MediaView" target="_blank" rel="external">DuanJiaNing/MediaView</a></center>

<p><center><i><b>END</b></i></center></p>
<font size="+1" color="#888888">如果觉得不错就给颗 star 吧 &gt;.&lt;</font>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="James Duan" />
          <p class="site-author-name" itemprop="name">James Duan</p>
           
              <p class="site-description motion-element" itemprop="description">￥.￥</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/DuanJiaNing" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/CAFE_BABE_Duan" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="2217611834" target="_blank" title="QQ">
                  
                    <i class="fa fa-fw fa-qq"></i>
                  
                  QQ
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/aimeimeits" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-blog"></i>
                  
                  CSDN
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="aimeimeits@gmail.com" target="_blank" title="email">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  email
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  Thu May 18 2017 08:00:00 GMT+0800 (中国标准时间) - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">James Duan</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"duanjianing.github.io/"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  
















  





  

  

  

  

  

</body>
</html>
