<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="android,java,blog,code" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="￥.￥">
<meta property="og:type" content="website">
<meta property="og:title" content="Duan">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Duan">
<meta property="og:description" content="￥.￥">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Duan">
<meta name="twitter:description" content="￥.￥">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title>Duan</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Duan</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">The more hard, the more fortunate.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/网易2017春招笔试真题编程题集合——9.涂棋盘/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="James Duan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Duan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/27/网易2017春招笔试真题编程题集合——9.涂棋盘/" itemprop="url">网易2017春招笔试真题编程题集合 —— 9.涂棋盘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-27T22:11:11+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="网易2017春招笔试真题编程题集合——9-涂棋盘"><a href="#网易2017春招笔试真题编程题集合——9-涂棋盘" class="headerlink" title="网易2017春招笔试真题编程题集合——9.涂棋盘"></a>网易2017春招笔试真题编程题集合——<strong>9.涂棋盘</strong></h3><h4 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h4><blockquote>
<p>小易有一块n*n的棋盘，棋盘的每一个格子都为黑色或者白色，小易现在要用他喜欢的红色去涂画棋盘。小易会找出棋盘中某一列中拥有相同颜色的最大的区域去涂画，帮助小易算算他会涂画多少个棋格。 </p>
</blockquote>
<p>原题地址在这里：<a href="https://www.nowcoder.com/question/next?pid=4575457&amp;qid=83061&amp;tid=7519540" target="_blank" rel="external">牛客网</a></p>
<p>输入描述：</p>
<blockquote>
<ul>
<li>输入数据包括n+1行：</li>
<li>第一行为一个整数n(1 ≤ n ≤ 50),即棋盘的大小</li>
<li>接下来的n行每行一个字符串表示第i行棋盘的颜色，’W’表示白色，’B’表示黑色</li>
</ul>
</blockquote>
<p>输出描述：</p>
<blockquote>
<p>输出小易会涂画的区域大小</p>
</blockquote>
<p>输入例子：</p>
<blockquote>
<p>3<br>BWW<br>BBB<br>BWB</p>
</blockquote>
<p>输出例子</p>
<blockquote>
<p>3</p>
</blockquote>
<h4 id="用java编写，思路是这样的："><a href="#用java编写，思路是这样的：" class="headerlink" title="用java编写，思路是这样的："></a>用java编写，思路是这样的：</h4><p>1 使用<code>java.util.Scanner</code>接收控制台输入<br>2 定义两个变量<code>int iw,ib</code>和一个数组<code>int[] maxs</code>: </p>
<ul>
<li><code>iw</code>用于累加当前列 <strong>W</strong> 连续出现的次数</li>
<li><code>ib</code>用于累加当前列 <strong>B</strong> 连续出现的次数</li>
<li><code>maxs</code> 数组用于记录每一列出现的<em>拥有相同颜色的最大的区域</em>（即在一列中出现 连续的相同颜色的<em>单元格</em> 的最大个数）</li>
<li><strong>遍历（双层循环）保存了W/B的二维数组，在内层循环里判断当前 <em>单元格</em> 的值是 W 还是 B ，是 W 的话：</strong><ul>
<li><strong>先 让负责记录当前列中 W 连续出现次数的 iw 自增1</strong></li>
<li><strong>后 判断用于记录当前列出现 <em>“拥有相同颜色的最大的区域”</em> 的 maxs[i]的值是否小于此时的 iw ，是则把 iw 的值赋给他，否则不改变他的值 </strong></li>
<li><strong>最后 让负责记录当前列中 B 连续出现次数的 ib 置为0，因为此时遇到了 W ，即 B 不连续了，被 W 打断了</strong></li>
</ul>
</li>
<li><strong>遇到 B 也是同样的操作：ib 自增1，判断当前的 maxs[i] ，把 iw 置为0；</strong>    </li>
<li>注意在开始遍历每一列前（外层循环内）要把 iw , ib ,maxs[i]置为0；</li>
</ul>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Arrays;</div><div class="line"><span class="keyword">import</span> java.util.Scanner;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Scanner in = <span class="keyword">new</span> Scanner(System.in);</div><div class="line">        <span class="keyword">int</span> n = in.nextInt();</div><div class="line">        <span class="keyword">if</span> (!(n &gt;= <span class="number">1</span> &amp;&amp; n &lt;= <span class="number">50</span>))</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        in.nextLine();</div><div class="line">        <span class="keyword">char</span>[][] res = <span class="keyword">new</span> <span class="keyword">char</span>[n][n];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            String str = in.nextLine();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">                res[i][j] = str.charAt(j);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> iw = <span class="number">0</span>, ib = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span>[] maxs= <span class="keyword">new</span> <span class="keyword">int</span>[n];</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">            maxs[i] = <span class="number">0</span>;</div><div class="line">            iw = ib = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">                <span class="keyword">if</span> (res[j][i] == <span class="string">'W'</span>) &#123;</div><div class="line">                    iw++;</div><div class="line">                    maxs[i] = iw &gt; maxs[i] ? iw : maxs[i];</div><div class="line">                    ib = <span class="number">0</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    ib++;</div><div class="line">                    maxs[i] = ib &gt; maxs[i] ? ib : maxs[i];</div><div class="line">                    iw = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        Arrays.sort(maxs);</div><div class="line">        System.out.println(<span class="string">""</span>+maxs[maxs.length - <span class="number">1</span>]);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><em>提交运行</em> 之后就会提示通过所有测试用例：<br><img src="http://img.blog.csdn.net/20170327220859483?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWltZWltZWlUUw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h4 id="注意点："><a href="#注意点：" class="headerlink" title="注意点："></a>注意点：</h4><ul>
<li>在使用 Scanner 接收控制台输入时先调用了 <code>int nextInt()</code> 方法，程序运行到该句时会阻塞，等待控制台输入并按回车，之后该方法就会返回输入的 int 值，别忘了此时还有一个  <em>回车符</em>  没有被解析，先要调用 <code>String nextLine()</code>把 <em>回车符</em>  消耗掉，否则在之后调用 <code>String nextLine()</code>获取输入的 W/B 时会出错。</li>
<li>调用<code>Arrays</code>类的<code>void sort(int[] a)</code>方法对 <code>maxs</code>数组进行排序（升序），输出<br><code>maxs[maxs.length - 1]</code>即为所求。</li>
</ul>
<center><u><b><em>END</em></b></u></center>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/26/Android-用WebView开发简单的浏览器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="James Duan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Duan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/26/Android-用WebView开发简单的浏览器/" itemprop="url">Android：用WebView开发简单的浏览器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-26T21:22:11+08:00">
                2017-03-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Android-用WebView开发简单的浏览器"><a href="#Android-用WebView开发简单的浏览器" class="headerlink" title="Android-用WebView开发简单的浏览器"></a>Android-用WebView开发简单的浏览器</h3><p>Android 提供了 WebView 组件，WebView 本身就是一个浏览器实现。</p>
<h3 id="例子中主要用到了-WebView-的以下方法："><a href="#例子中主要用到了-WebView-的以下方法：" class="headerlink" title="例子中主要用到了 WebView 的以下方法："></a>例子中主要用到了 WebView 的以下方法：</h3><ul>
<li>void loadUrl(String url) 加载指定 url 对应的网页</li>
<li>void goBack() 后退</li>
<li>void goForward() 前进</li>
<li>boolean canGoBack() 根据<code>历史记录</code>判断是否可以回退</li>
<li>boolean canGoForward() 根据<code>历史记录</code>判断是否可以前进</li>
<li>WebSettings getSettings() 获得对 WebView 进行控制的 WebSettings 对象<br>（调用其<code>setJavaScriptEnabled</code>方法使<code>WebView</code>支持<code>JavaScript</code>）</li>
<li>void setWebViewClient(WebViewClient client) WebViewClient 负责处理<br>WebView 各种通知，请求，比如页面开始加载及加载完成、资源加载中、url已打开等</li>
<li>void setWebChromeClient(WebChromeClient client) WebChromeClient主要辅助WebView处理Javascript的对话框、网站图标、网站title、<strong>加载进度</strong>等</li>
</ul>
<h3 id="浏览器功能概述："><a href="#浏览器功能概述：" class="headerlink" title="浏览器功能概述："></a>浏览器功能概述：</h3><ol>
<li>第一次打开应用时默认会把<code>百度</code>设置为首页，可通过底部<code>主页</code>按钮跳转到主页，或通过长按弹出对话框修改主页</li>
<li><code>主页</code>的 URL 地址使用<code>SharedPreference</code>保存</li>
<li>底部四个<code>ImageButton</code>从做往右依次为<code>主页</code> <code>刷新</code> <code>回退</code> <code>前进</code></li>
<li>顶部的<code>ActionBar</code>用<code>void setCustomView(View)</code>添加了一个自定义的用于<code>输入网址</code>的输入框和一个<code>转到</code>按钮，<code>转到</code>按钮默认是不可见且不可用的，当点击了用于<code>输入网址</code>的<code>EditText</code>就会显示并可用。</li>
<li>用于显示网页加载进度的<code>ProgressBar</code></li>
</ol>
<h3 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h3><p><img src="http://img.blog.csdn.net/20170326211407503?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWltZWltZWlUUw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h3><ul>
<li>每次打开一个网页时会调用该方法，在这里控制<code>ActionBar</code>内的<code>Edittext</code>显示<code>加载中...</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>&#123;</div><div class="line">                <span class="keyword">super</span>.onPageStarted(view, url, favicon);</div><div class="line">                mShowTitle.setText(<span class="string">"加载中..."</span>);</div><div class="line">            &#125;</div><div class="line">            ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>覆写<code>shouldOverrideUrlLoading</code>并返回<code>true</code>，否则 WebView 默认会调用系统的浏览器或第三方浏览器，而不使用当前activity中的<code>WebView</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</div><div class="line">			...</div><div class="line">			<span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">                view.loadUrl(url);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">		    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>当网页加载进度改变时会回调<code>onProgressChanged</code>方法，在这里更新用于显示进度的<code>ProgressBar</code>。注意<code>newProgress</code>值为 0 到 100 ，因而将<code>ProgressBar</code>最大值设为 100 。</li>
<li><p><code>onReceivedTitle</code>返回当前加载网页的标题将标题显示在 actionBar 内的 EditText 上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">mWebView.setWebChromeClient(<span class="keyword">new</span> WebChromeClient() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(WebView view, <span class="keyword">int</span> newProgress)</span> </span>&#123;</div><div class="line">                mProgressBar.setProgress(newProgress);</div><div class="line">                <span class="keyword">if</span> (newProgress == <span class="number">100</span>) &#123;</div><div class="line">                    mProgressBar.postDelayed(() -&gt; mProgressBar.setProgress(<span class="number">0</span>), <span class="number">2000</span>);</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedTitle</span><span class="params">(WebView view, String title)</span> </span>&#123;</div><div class="line">                <span class="keyword">super</span>.onReceivedTitle(view, title);</div><div class="line">                currentUrlTitle = title;</div><div class="line">                mShowTitle.setText(currentUrlTitle);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>监听物理按键<code>返回</code>的点击事件，如果<code>WebView</code>的<code>历史记录</code>里有上一页相关记录就调用<code>void goBack()</code>方法</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mWebView.canGoBack())</div><div class="line">            mWebView.goBack();</div><div class="line">        <span class="keyword">else</span> finish();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>判断当前是否处于正在输入网址（actionBar上的 EditText）的状态<br>1 是的话调用此方法表示输入结束从使<code>转到</code>按钮消失并不可用<br>2 使<code>EditText</code>控件失去焦点，不然会一直显示光标，效果不好</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finishEdit</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isEditFocus) &#123;</div><div class="line">            isEditFocus = <span class="keyword">false</span>;</div><div class="line">            mShowTitle.clearFocus();</div><div class="line"></div><div class="line">            Animation animation = AnimationUtils.loadAnimation(MainActivity.<span class="keyword">this</span>, android.R.anim.fade_out);</div><div class="line">            animation.setFillAfter(<span class="keyword">true</span>);</div><div class="line">            mLoadUrl.startAnimation(animation);</div><div class="line">            mLoadUrl.setEnabled(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">            mShowTitle.setText(currentUrlTitle);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>这个方法有三个地方调用到：<br>1 当正在输入网址时用户转移注意力到<code>WebView</code>上，并触摸到<code>WebView</code>，此时会先判断软键盘是否正在显示，正在显示就关闭软键盘然后使输入框失去焦点并隐藏<code>转到</code>按钮</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mWebView.setOnTouchListener((View view, MotionEvent event) -&gt; &#123;</div><div class="line">      <span class="keyword">if</span> (event.getAction() == MotionEvent.ACTION_DOWN) &#123;</div><div class="line">          finishEdit();</div><div class="line">          InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);</div><div class="line">          <span class="keyword">if</span> (imm.isActive())</div><div class="line">              imm.hideSoftInputFromWindow(mShowTitle.getWindowToken(),<span class="number">0</span>);</div><div class="line"></div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
<p>2 当<strong>正在输入</strong>网址时点击了物理按键<code>返回</code>,此时<code>void onBackPressed()</code>方法是不会被调用的，因为此时软键盘正在显示，调用<code>boolean dispatchKeyEvent(KeyEvent event)</code>方法拦截<code>返回</code>按键的点击事件，关闭软键盘的同时使输入框失去焦点并隐藏<code>转到</code>按钮。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchKeyEvent</span><span class="params">(KeyEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (event.getKeyCode() == KeyEvent.KEYCODE_BACK)</div><div class="line">            finishEdit();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchKeyEvent(event);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>3  点击了 actionBar 处的<code>转到</code>按钮<br>3.1 此时要先判断是否正确输入，然后判断输入网址是否是新的（和当前正在显示的网页的网址不同），满足就让<code>WebView</code>加载该网页<br>3.2 判断软键盘是否正在显示，正在显示就关闭软键盘然后使输入框失去焦点并隐藏<code>转到</code>按钮</p>
<blockquote>
<p>以下代码包含所有按钮的点击事件，每个按钮都在xml中添加了<br><code>android:onClick=&quot;onClick&quot;</code>属性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">       <span class="keyword">switch</span> (view.getId()) &#123;</div><div class="line">           <span class="keyword">case</span> R.id.main_goBack:</div><div class="line">               <span class="keyword">if</span> (mWebView.canGoBack())</div><div class="line">                   mWebView.goBack();</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">case</span> R.id.main_goForward:</div><div class="line">               <span class="keyword">if</span> (mWebView.canGoForward())</div><div class="line">                   mWebView.goForward();</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">case</span> R.id.main_refresh:</div><div class="line">               mWebView.loadUrl(currentUrl);</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">case</span> R.id.actionBar_goto:</div><div class="line">               String url = mShowTitle.getText().toString() == <span class="string">""</span> ? <span class="keyword">null</span> : mShowTitle.getText().toString().equals(currentUrl) ? <span class="keyword">null</span> : mShowTitle.getText().toString();</div><div class="line">               <span class="keyword">if</span> (url != <span class="keyword">null</span>)</div><div class="line">                   mWebView.loadUrl(url);</div><div class="line"></div><div class="line">               InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);</div><div class="line">               <span class="keyword">if</span> (imm.isActive())</div><div class="line">                   imm.hideSoftInputFromWindow(mShowTitle.getWindowToken(),<span class="number">0</span>);</div><div class="line"></div><div class="line">               finishEdit();</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">case</span> R.id.main_home:</div><div class="line">               <span class="keyword">if</span> (!currentUrl.equals(homeUrl))</div><div class="line">                   mWebView.loadUrl(homeUrl);</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h3 id="值得注意的地方："><a href="#值得注意的地方：" class="headerlink" title="值得注意的地方："></a>值得注意的地方：</h3><ul>
<li><p>在style中使用<code>colorControlHighlight</code>属性改变默认的按钮点击波纹效果的颜色<br>比如这样：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorControlHighlight"</span>&gt;</span>@color/colorPrimary<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>在按钮的xml属性中通过设置</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">style=`"@style/Base.Widget.AppCompat.Button.Borderless.Colored"</div></pre></td></tr></table></figure>
<p>使按钮的点击效果不受布局边界限制。其他默认不可点击的view（如EditText，TextView等）还要在添加一个：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:clickable="true"</div></pre></td></tr></table></figure>
<ul>
<li>使用到的图标在这里下载的：<a href="https://material.io/icons/" target="_blank" rel="external">Material icons - Material Design</a></li>
<li>调用<code>ActionBar</code>的<code>setCustomView</code>方法前先要调用<code>setDisplayShowCustomEnabled</code>方法并置为true。</li>
<li>修改主页用到了对话框：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">AlertDialog.Builder builder</div><div class="line"> .setTitle(<span class="string">"修改主页"</span>)</div><div class="line">    .setNegativeButton(<span class="string">"取消"</span>, (DialogInterface dialog, <span class="keyword">int</span> which) -&gt; dialog.dismiss())</div></pre></td></tr></table></figure>
<p>这里本来是用<code>new DialogInterface.OnClickListener() {...}</code>的形式写的，后来改成使用<code>Lambda</code>的方式，这时要在app的<code>build.gradle</code>里加上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ...</div><div class="line">        jackOptions &#123;</div><div class="line">            enabled true</div><div class="line">        &#125;</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">    compileOptions &#123;</div><div class="line">        targetCompatibility 1.8</div><div class="line">        sourceCompatibility 1.8</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<center><u><b><em>END</em></b></u></center>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/22/Android-Activity-的生命周期常用方法概述/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="James Duan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Duan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/22/Android-Activity-的生命周期常用方法概述/" itemprop="url">Android：Activity 的生命周期常用方法概述</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-22T21:14:11+08:00">
                2017-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Android-activity的生命周期常用方法概述</p>
<h4 id="activity生命周期"><a href="#activity生命周期" class="headerlink" title="activity生命周期"></a>activity生命周期</h4><ol>
<li>activity大致会经过如下四种状态</li>
</ol>
<ul>
<li>运行状态：当前activity位于前台，用户可见，可以获得焦点</li>
<li>暂停状态：其他activity位于前台，该activity依然可见，但不能获得焦点</li>
<li>停止状态：当前activity不可见，失去焦点</li>
</ul>
<ol>
<li>activity生命周期的常用方法</li>
</ol>
<p>#####1.onCreate：</p>
<p>在activity的生命周期中这个方法是创建activity后第一个被系统调用的方<br>法。该方法只会调用一次。<br><code>Bundle savedInstanceState</code>：Bundle类型的数据类似<code>Map</code>，以<code>key-value</code>的<br>形式存储数据。</p>
<blockquote>
<p>If the activity is being re-initialized after previously being shut down then this Bundle contains the data it most recently supplied in onSaveInstanceState(Bundle). Note: Otherwise it is null.<br><br></p>
</blockquote>
<p>如果活动在先前被关闭之后被重新初始化，那么该Bundle包含最近在<br>onSaveInstanceState（Bundle）中提供的数据。 注意：否则为null。</p>
<p><code>savedInstanceState</code>参数的来源是activity生命周期的<code>onSaveInstanceState</code>方法<br>那<font color="red">活动在先前被关闭之后被重新初始化</font>指的是那些情况呢？</p>
<ul>
<li>手机屏幕从竖屏切换成横屏或横屏切换成竖屏</li>
<li>程序从全屏显示切换为分屏显示的时候，回切也会调用<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="API-21-加入的三个重载方法"><a href="#API-21-加入的三个重载方法" class="headerlink" title="API 21 加入的三个重载方法"></a>API 21 加入的三个重载方法</h5><p>API 21 为activity新增了一个属性<code>android:persistableMode</code>，将该属性设置<br>为<code>persistAcrossReboots</code>activity就具有持久化的能力，另外需要配合一个新<br>的Bundle<code>PersistableBundle</code>来保存数据。</p>
<ul>
<li>API 21 之前的<code>onRestoreInstanceState</code>,<code>onSaveInstanceState</code>,<code>onCreate</code>内的Bundle是在用户按下HOME键，返回键以及切换横竖屏等操作后回调<code>onSaveInstanceState</code>来操作交换的，而API 21 之后的这三个方法内的<code>PersistableBundle</code>则是针对<strong>系统关机重启</strong>的情况。<a href="http://blog.csdn.net/lincyang/article/details/45287599" target="_blank" rel="external">参考</a><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSaveInstanceState</span><span class="params">(Bundle outState, PersistableBundle outPersistentState)</span></span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span><span class="params">(Bundle savedInstanceState, PersistableBundle persistentState)</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState, PersistableBundle persistentState)</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="2-onStart"><a href="#2-onStart" class="headerlink" title="2.onStart"></a>2.onStart</h5><blockquote>
<p>Called after onCreate — or after onRestart when the activity had been stopped, but is now again being displayed to the user. It will be followed by onResume.Derived classes must call through to the super class’s implementation of this method. If they do not, an exception will be thrown.<br></p>
</blockquote>
<ul>
<li>在onCreate方法后调用</li>
<li>当activity调用了onStop方法后（该activity已不可见）用户再次打开（回</li>
<li>到）该activity时调用onRestart，之后就会后调用onStart方法</li>
<li>在衍生类（子类）的该方法中必须调用父类的onStart()方法，否则就会<br>抛出异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onStart();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="3-onResume"><a href="#3-onResume" class="headerlink" title="3.onResume"></a>3.onResume</h5><blockquote>
<p>Called after onRestoreInstanceState, onRestart, or onPause, for your activity to start interacting with the user. This is a good place to begin animations, open exclusive-access devices (such as the camera), etc.Keep in mind that onResume is not the best indicator that your activity is visible to the user; a system window such as the keyguard may be in front. Use onWindowFocusChanged to know for certain that your activity is visible to the user (for example, to resume a game).Derived classes must call through to the super class’s implementation of this method. If they do not, an exception will be thrown.</p>
</blockquote>
<ul>
<li>在onRestoreInstanceState, onRestart, or onPause后都有可能调用，调用此方法表示应用可以与用户进行交互。</li>
<li>在这里开始动画，打开独占设备（比如相机）等</li>
<li>注意此方法不是判断你的activity是否对用户可见的最佳指标，诸如软键盘，对话框等可能在你的activity的前面</li>
<li>使用onWindowFocusChanged 来确定activity对用户可见（比如在恢复游戏时）</li>
<li>在衍生类（子类）的该方法中必须调用父类的onResume()方法，否则就会抛出异常</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onResume();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="4-onPause"><a href="#4-onPause" class="headerlink" title="4.onPause"></a>4.onPause</h5><blockquote>
<p>Called as part of the activity lifecycle when an activity is going into the background, but has not (yet) been killed. The counterpart to onResume.When activity B is launched in front of activity A, this callback will be invoked on A. B will not be created until A’s onPause returns, so be sure to not do anything lengthy here.This callback is mostly used for saving any persistent state the activity is editing, to present a “edit in place” model to the user and making sure nothing is lost if there are not enough resources to start the new activity without first killing this one. This is also a good place to do things like stop animations and other things that consume a noticeable amount of CPU in order to make the switch to the next activity as fast as possible, or to close resources that are exclusive access such as the camera.In situations where the system needs more memory it may kill paused processes to reclaim resources. Because of this, you should be sure that all of your state is saved by the time you return from this function. In general onSaveInstanceState is used to save per-instance state in the activity and this method is used to store global persistent data (in content providers, files, etc.)After receiving this call you will usually receive a following call to onStop (after the next activity has been resumed and displayed), however in some cases there will be a direct call back to onResume without going through the stopped state.Derived classes must call through to the super class’s implementation of this method. If they do not, an exception will be thrown.<br></p>
</blockquote>
<ul>
<li>当activity进入后台但activity没有（还没）被杀死时会调用此方法。</li>
<li>当activity A 处于可见状态，此时你打开了activity B ，这时activity A 的onPause方法会被调用。<strong>activity B </strong>将不会被创建直到A的onPause方法返回，所以不要在这里进行耗时操作。</li>
<li>这个回调方法大多用于保存正在编辑的任何持续性状态，向用户展现当前进行的编辑正常结束的状态，确保当出现<strong>不杀死当前的activity是没有足够资源启动新的activity的</strong>的情况时不会丢失用户正在编辑的数据。</li>
<li>在此停止动画和其他对CPU消耗较大的事情，或者关闭独占资源（相机等），以便更快的切换到另一个activity</li>
<li>在系统需要更多资源分配给其他更高优先级的应用时可能会杀死已暂停的进程以回收资源。因此要确保这个函数返回时要尽快的把程序的状态保存下来，而<code>onSaveInstanceState</code>就是负责这个的。所以可以覆写<code>onSaveInstanceState</code>来保存你自己的程序状态。</li>
<li>此方法调用后通常会调用onStop方法，但一些情况下也会直接调用onResume而不执行onStop进入停止状态</li>
<li>在衍生类（子类）的该方法中必须调用父类的onResume()方法，否则就会抛出异常<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onPause();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="5-onStop"><a href="#5-onStop" class="headerlink" title="5.onStop"></a>5.onStop</h5><blockquote>
<p>Called when you are no longer visible to the user. You will next receive either onRestart, onDestroy, or nothing, depending on later user activity.Derived classes must call through to the super class’s implementation of this method. If they do not, an exception will be thrown.</p>
</blockquote>
<ul>
<li>当activity不可见时调用，在onPause一般会调用此方法（覆写了<br>onSaveInstanceState的话先调用onSaveInstanceState后调用此方法），有时也不会（onPause后调用了onResume）。</li>
<li>调用此方法后会调用onRestart（activity在此可见）、onDestroy（activity被销毁）或什么都不调用（应用进程被杀死），取决于后续用户的操作。</li>
<li>在衍生类（子类）的该方法中必须调用父类的onResume()方法，否则就会抛出异常<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onStop();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>#####6.onDestroy</p>
<blockquote>
<p>Perform any final cleanup before an activity is destroyed. This can happen either because the activity is finishing (someone called finish on it, or because the system is temporarily destroying this instance of the activity to save space. You can distinguish between these two scenarios with the isFinishing method.Note: do not count on this method being called as a place for saving data! For example, if an activity is editing data in a content provider, those edits should be committed in either onPause or onSaveInstanceState, not here. This method is usually implemented to free resources like threads that are associated with an activity, so that a destroyed activity does not leave such things around while the rest of its application is still running. There are situations where the system will simply kill the activity’s hosting process without calling this method (or any others) in it, so it should not be used to do things that are intended to remain around after the process goes away.Derived classes must call through to the super class’s implementation of this method. If they do not, an exception will be thrown.</p>
</blockquote>
<ul>
<li>在activity被销毁时回调，只会调用一次</li>
<li>不要在该方法里保存数据，这些编辑应该在onPause或onSaveInstanceState中提交，而不是在这里。</li>
<li>通常该方法用于释放资源，结束开启的线程，确保应用还在运行时而该activity结束不留下一些属于该activity而不属于应用的东西。</li>
<li>系统也可能会简单的杀死应用进程而不调用此方法或其它的任何方法，因此此方法不应该被用来做那些不需要应用进程而运行的功能（如开启服务等）。<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDestroy();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<center>还有一张来自stromzhang公众号的图：</center><br><br><img src="http://img.blog.csdn.net/20170322211135973?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWltZWltZWlUUw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><br>参考：<a href="http://blog.csdn.net/zhao_3546/article/details/12843477" target="_blank" rel="external">Android Activity为什么要细化出onCreate、onStart、onResume、onPause、onStop、onDesdroy这么多方法让应用去重载？</a><br><br><br><center><u><b><em>END</em></b></u></center>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/19/Android-使用HttpURLConnection实现多线程下载/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="James Duan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Duan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/19/Android-使用HttpURLConnection实现多线程下载/" itemprop="url">Android：使用 HttpURLConnection 实现多线程下载</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-19T15:26:11+08:00">
                2017-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="使用HttpURLConnection实现多线程下载"><a href="#使用HttpURLConnection实现多线程下载" class="headerlink" title="使用HttpURLConnection实现多线程下载"></a>使用<code>HttpURLConnection</code>实现<strong>多线程下载</strong></h4><p>这个小程序是根据《疯狂Android讲义》<em>（第三版）</em>第13章 <em>Android网络应用</em>，13.3节 <em>使用HTTP访问网络</em>  扩展而来。<br><br></p>
<blockquote>
<p>使用多线程下载文件可以更快地完成下载任务，因为客户端启动多条线程进行下载就意味着服务器也需要为该客户端提供相应的服务。假设服务器同时最多服务100个用户，在服务器中一个线程对应一个用户，100条线程在计算机内并发执行，也就是由CPU划分时间轮片流执行，如果A应用使用了99条线程下载文件，那么相当于占用了99个用户的资源，自然就拥有了较快的下载速度。<font size="-1"><em>不考虑网络因素</em></font></p>
</blockquote>
<p><em>实际上并不是客户端并发的下载线程越多下载速度就越快，因为当开启太多并发线程后，应用程序需要维护每条线程的开销，线程同步的开销，这些开销可能反而使下载速度减慢</em></p>
<h4 id="先看看最终效果"><a href="#先看看最终效果" class="headerlink" title="先看看最终效果"></a>先看看最终效果</h4><p><img src="http://img.blog.csdn.net/20170319152750479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWltZWltZWlUUw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170319152905169?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWltZWltZWlUUw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170319153003310?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWltZWltZWlUUw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170319153045342?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWltZWltZWlUUw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h5 id="1-这个小程序中负责开启多线程下载的核心类是：DownloadUtil-java"><a href="#1-这个小程序中负责开启多线程下载的核心类是：DownloadUtil-java" class="headerlink" title="1.这个小程序中负责开启多线程下载的核心类是：DownloadUtil.java"></a>1.这个小程序中负责开启多线程下载的核心类是：<code>DownloadUtil.java</code></h5><h6 id="这个类主要做了如下的事情："><a href="#这个类主要做了如下的事情：" class="headerlink" title="这个类主要做了如下的事情："></a>这个类主要做了如下的事情：</h6><ul>
<li>创建URL对象（本程序使用的是<code>HttpURLConnection</code>）</li>
<li>获取URL指向资源的大小（由<code>HttpURLConnection.getContentLength()</code>方法完成）</li>
<li>在本地磁盘上创建一个与网络资源相同大小的空文件<br>（<code>RandomAccessFile.setLength()</code>）</li>
<li>计算每条线程应该下载网络资源的哪一部分<br>（<em>从哪个字节开始，到哪个字节结束</em>）</li>
<li>依次创建，启动多条线程来下载网络资源的指定部分</li>
</ul>
<p>######下面来看具体代码：</p>
<ol>
<li>先来看构造函数</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">DownloadUtil</span><span class="params">(OnDownloadFinish complete)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.downloadFinish = complete;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p><code>OnDownloadFinish</code>是下载完成后的回调</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnDownloadFinish</span> </span>&#123;</div><div class="line">      <span class="comment">/**</span></div><div class="line">       * 所有线程都结束后调用</div><div class="line">       * <span class="doctag">@param</span> file 下载好的文件</div><div class="line">       */</div><div class="line">      <span class="function"><span class="keyword">void</span> <span class="title">onComplete</span><span class="params">(File file)</span></span>;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ol>
<li>开启下载任务的入口方法<br>下载前的计算和开启线程下载都在这个方法中完成</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    * 开始一次下载</div><div class="line">    * <span class="doctag">@param</span> sourcePath 目标URL</div><div class="line">    * <span class="doctag">@param</span> targetFilePath 目标保存路径</div><div class="line">    * <span class="doctag">@param</span> threadNumber 开启的线程数</div><div class="line">    * <span class="doctag">@param</span> fileName 保存的文件名</div><div class="line">    * <span class="doctag">@throws</span> IOException</div><div class="line">    */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(@NonNull String sourcePath, @Nullable String targetFilePath, <span class="keyword">int</span> threadNumber, @Nullable String fileName)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line"> ....</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li><strong>创建HttpURLConnection对象：</strong><br>对于一次下载该对象指向的URL资源地址应是同一个，封装成一个方法：<br>该方法在两个地方被调用到</li>
</ol>
<ul>
<li>获得URL指向资源大小时。<em>获得大小后关闭该网络连接</em></li>
<li>启动线程下载该线程对应的那部分资源时</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> HttpURLConnection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">       URL url = <span class="keyword">new</span> URL(sourcePath);</div><div class="line">       HttpURLConnection conn = (HttpURLConnection) url.openConnection();</div><div class="line">       conn.setConnectTimeout(<span class="number">1000</span> * <span class="number">5</span>);</div><div class="line">       conn.setRequestMethod(<span class="string">"GET"</span>);</div><div class="line">       conn.setRequestProperty(<span class="string">"Accept"</span>, accept);</div><div class="line">       conn.setRequestProperty(<span class="string">"Accept-Language"</span>, <span class="string">"zh-CN"</span>);</div><div class="line">       conn.setRequestProperty(<span class="string">"Charset"</span>, <span class="string">"UTF-8"</span>);</div><div class="line">       <span class="keyword">return</span> conn;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ol>
<li>下载前的计算和开启多个线程进行下载：<br>获得大小-&gt;本地磁盘创建同大小的空文件-&gt;求得每一个线程应下载多少字节-&gt;开启线程进行下载</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">HttpURLConnection conn = getConnection();</div><div class="line">      fileSize = conn.getContentLength();</div><div class="line">      conn.disconnect();</div><div class="line"></div><div class="line">      RandomAccessFile file = <span class="keyword">new</span> RandomAccessFile(targetFilePathAndName, <span class="string">"rw"</span>);</div><div class="line">      file.setLength(fileSize);</div><div class="line">      file.close();</div><div class="line"></div><div class="line">      partSize = fileSize / threadNumber + <span class="number">1</span>;</div><div class="line"></div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadNumber; i++) &#123;</div><div class="line">          <span class="keyword">int</span> startPos = i * partSize;</div><div class="line">          threads[i] = <span class="keyword">new</span> DownLoadThread(startPos);</div><div class="line">          threads[i].start();</div><div class="line">      &#125;</div></pre></td></tr></table></figure>
<ol>
<li>负责下载的线程类<code>private class</code> <strong><code>DownLoadThread</code></strong> <code>extends Thread</code><br>来看run方法<br>在构造函数中写了该句<code>currentPart = new RandomAccessFile(targetFilePathAndName, &quot;rw&quot;);</code></li>
</ol>
<blockquote>
<p> <code>RandomAccessFile</code>: RandomAccessFile是用来访问那些保存数据记录的文件的，你可以用seek( )方法来访问记录，并进行读写了。这些记录的大小不必相同；但是其大小和位置必须是可知的。但是该类仅限于操作文件。——<a href="http://blog.csdn.net/akon_vm/article/details/7429245" target="_blank" rel="external">Java RandomAccessFile用法 </a><br><br>RandomAccessFile的对象包含一个记录指针，用于标识当前流的读写位置，这个位置可以向前移动，也可以向后移动。RandomAccessFile包含两个方法来操作文件记录指针。</p>
<ul>
<li>long getFilePoint():记录文件指针的当前位置。</li>
<li>void seek(long pos):将文件记录指针定位到pos位置</li>
</ul>
</blockquote>
<hr>
<p>在<code>finally</code>里判断当前还有几个线程还在下载，当没有线程在下载了（下载结束了），就回调<code>onComplete</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">          <span class="keyword">try</span> &#123;</div><div class="line">              HttpURLConnection connection = getConnection();</div><div class="line">              InputStream in = connection.getInputStream();</div><div class="line">              skipFully(in, startPos);</div><div class="line">              <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">              <span class="keyword">int</span> hasRead;</div><div class="line">              <span class="keyword">while</span> ((currentDownLoaded &lt; partSize) &amp;&amp; (hasRead = in.read(bytes)) &gt; <span class="number">0</span>) &#123;</div><div class="line">                  currentPart.write(bytes, <span class="number">0</span>, hasRead);</div><div class="line">                  currentDownLoaded += hasRead;</div><div class="line">              &#125;</div><div class="line">              currentPart.close();</div><div class="line">              in.close();</div><div class="line">              connection.disconnect();</div><div class="line"></div><div class="line">          &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</div><div class="line">              e.printStackTrace();</div><div class="line">          &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">              e.printStackTrace();</div><div class="line">          &#125; <span class="keyword">finally</span> &#123;</div><div class="line">              restTask--;</div><div class="line">              <span class="keyword">if</span> (restTask == <span class="number">0</span>)</div><div class="line">                  downloadFinish.onComplete(<span class="keyword">new</span> File(targetFilePathAndName));</div><div class="line"></div><div class="line">          &#125;</div><div class="line"></div><div class="line">      &#125;</div></pre></td></tr></table></figure>
<p>其中用到一个跳过指定字节数的方法</p>
<blockquote>
<p>由于最新的Android平台上调用InputStream的skip方法时，并不能总是准确地跳过指定的字节数，因此程序实现了一个skipFully方法。</p>
</blockquote>
<p>参考此处：<br><a href="http://www.ablanxue.com/prone_7005_1.html" target="_blank" rel="external">Java.IO.InputStream.skip() 错误（跳过字节数和预想的不等）</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 从输入流中从起点开始跳过指定长度</div><div class="line">     * <span class="doctag">@param</span> in    输入流</div><div class="line">     * <span class="doctag">@param</span> bytes 要跳过的字节数</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">skipFully</span><span class="params">(InputStream in, <span class="keyword">long</span> bytes)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">long</span> len;</div><div class="line">        <span class="keyword">while</span> (bytes &gt; <span class="number">0</span>) &#123;</div><div class="line">            len = in.skip(bytes);</div><div class="line">            bytes -= len;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>好了，以上就时进行多线程下载的核心类，源码已上传到GitHub，你可以在这里找到：</p>
<center><a href="https://github.com/DuanJiaNing/MultithreadDownload" target="_blank" rel="external">DuanJiaNing/MultithreadDownload</a></center>

<h5 id="2-Activity部分"><a href="#2-Activity部分" class="headerlink" title="2. Activity部分"></a>2. Activity部分</h5><p>布局部分用到的控件主要有：<br><code>TextView</code>,<code>EditText</code>,<code>ProgressBar</code>,<code>CardView</code>,<code>FloatingActionButton</code>和<code>ListView</code>.</p>
<h6 id="看起来是这样子的："><a href="#看起来是这样子的：" class="headerlink" title="看起来是这样子的："></a>看起来是这样子的：</h6><p><img src="http://img.blog.csdn.net/20170319152128133?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWltZWltZWlUUw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>解释一下：</p>
<ul>
<li>最上面的<code>任务详情</code>:<br>1.当点击了<code>下载</code>之后当前正在下载任务的信息会显示在这里。<br>2.当已完成多个下载任务后，已下载的文件名会显示在<code>ListView</code>处，<code>ListView</code>的<code>onItemClick</code>时间会获得已下载文件对应的下载信息显示在这里。</li>
<li><code>进度</code>下面有个<code>ProgressBar</code>用于实时显示当前的下载进度</li>
<li><code>下载速度</code>处显示实时的下载速度（两行<code>byte/s kb/s</code>）</li>
<li><code>下载速度</code><strong>右边</strong>也会显示实时的下载进度，对应<code>ProgressBar</code>的 <code>Max</code>和<code>当前进度</code>.</li>
<li><code>已下载</code><strong>上边</strong>有个<code>TextView</code>显示文件保存的路径</li>
<li><code>FloatingActionButton</code>控制输入URL输入框，线程数输入框，下载按钮所在的<code>CardView</code>的显示和隐藏。<br><img src="./Image_001.png" alt="Alt text"></li>
</ul>
<h6 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h6><ol>
<li>进入onCreate关联布局后其他几乎都在<code>init</code>方法里搞定了<strong><code>&gt;.&lt;</code></strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">      setContentView(R.layout.main_activity);</div><div class="line"></div><div class="line">      init();</div><div class="line"></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ol>
<li><code>init()</code>方法里做了这么些事情：</li>
</ol>
<ul>
<li>初始化控件</li>
<li>初始化用于保存已下载文件名和对应任务信息的<code>ArrayList</code></li>
<li><code>ListView</code>绑定<code>adapter</code>，item点击事件</li>
<li>从<code>anim</code>和<code>animator</code>中加载动画资源并绑定给<code>FloatingActionButton</code>和<code>CardView</code>,<code>FloatingActionButton</code>的点击事件（控制动画播放）</li>
<li><code>new</code>一个<code>DownloadUtil</code>实例并定义回调方法<code>onComplete</code>,在这里遇到了不少问题[^1] [^2]（亦可在源码注释中查看）</li>
<li><code>下载</code>按钮的点击事件，在点击事件里调用<code>DownloadUtil.start</code>方法，因为<code>start</code>方法里调用了<code>URLConnection.openConnection</code>方法，所以不能在<strong>UI线程</strong>里调用此方法。同时在这里开<br>启<code>Timer</code>实时更新UI。注意<a href="只有在调用了`DownloadUtil.start`方法后，DownloadUtil的`getFileSize(),getThreadNumber(),getPartSize()`等`Getter`方法才会正确的取到值。">^3</a></li>
</ul>
<ol>
<li>控制<code>CardView</code>动画的代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> AnimatorSet cvShow = (AnimatorSet) AnimatorInflater.loadAnimator(<span class="keyword">this</span>, R.animator.input_show);</div><div class="line">       <span class="keyword">final</span> AnimatorSet cvHide = (AnimatorSet) AnimatorInflater.loadAnimator(<span class="keyword">this</span>, R.animator.input_hide);</div><div class="line">       cvShow.setTarget(cardView);</div><div class="line">       cvHide.setTarget(cardView);</div><div class="line"></div><div class="line">       input.setPivotX(<span class="number">100</span>);<span class="comment">//用ObjectAnimator实现旋转动画时用此方法指定旋转的原点</span></div><div class="line">       <span class="keyword">final</span> ObjectAnimator btShow = ObjectAnimator.ofFloat(input, <span class="string">"rotation"</span>, <span class="number">0</span>, <span class="number">180</span>).setDuration(<span class="number">1000</span>);</div><div class="line">       <span class="keyword">final</span> ObjectAnimator btHide = ObjectAnimator.ofFloat(input, <span class="string">"rotation"</span>, <span class="number">180</span>, <span class="number">0</span>).setDuration(<span class="number">1000</span>);</div><div class="line">       btShow.setInterpolator(<span class="keyword">new</span> OvershootInterpolator());</div><div class="line">       btHide.setInterpolator(<span class="keyword">new</span> DecelerateInterpolator());</div><div class="line"></div><div class="line">       btShow.start();</div><div class="line">       cvShow.start();</div><div class="line"></div><div class="line">       input.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">           <span class="keyword">boolean</span> hasCardViewShow = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">               <span class="keyword">if</span> (hasCardViewShow) &#123;</div><div class="line">                   btHide.start();</div><div class="line">                   cvHide.start();</div><div class="line">                   hasCardViewShow = <span class="keyword">false</span>;</div><div class="line">               &#125; <span class="keyword">else</span> &#123;</div><div class="line">                   btShow.start();</div><div class="line">                   cvShow.start();</div><div class="line">                   hasCardViewShow = <span class="keyword">true</span>;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;);</div></pre></td></tr></table></figure>
<ol>
<li>下载完成后的回调和下载按钮的点击事件<br>代码有点多就直接上张图吧！<br><img src="http://img.blog.csdn.net/20170319152255946?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYWltZWltZWlUUw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></li>
<li>还有动画部分的代码</li>
</ol>
<p>控制cardView隐藏<br><code>/res/animator/input_hide.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:ordering</span>=<span class="string">"together"</span></div><div class="line">    &gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"800"</span></div><div class="line">        <span class="attr">android:propertyName</span>=<span class="string">"translationY"</span></div><div class="line">        <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/linear_interpolator"</span></div><div class="line">        <span class="attr">android:valueFrom</span>=<span class="string">"0.0f"</span></div><div class="line">        <span class="attr">android:valueTo</span>=<span class="string">"400.0f"</span></div><div class="line">        <span class="attr">android:valueType</span>=<span class="string">"floatType"</span></div><div class="line">        /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"1000"</span></div><div class="line">        <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></div><div class="line">        <span class="attr">android:valueFrom</span>=<span class="string">"1.0f"</span></div><div class="line">        <span class="attr">android:valueTo</span>=<span class="string">"0.0f"</span></div><div class="line">        <span class="attr">android:valueType</span>=<span class="string">"floatType"</span></div><div class="line">        /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p>控制cardView显示<br><code>/res/animator/input_show.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:ordering</span>=<span class="string">"together"</span></div><div class="line">    &gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"800"</span></div><div class="line">        <span class="attr">android:propertyName</span>=<span class="string">"translationY"</span></div><div class="line">        <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/overshoot_interpolator"</span></div><div class="line">        <span class="attr">android:valueFrom</span>=<span class="string">"400f"</span></div><div class="line">        <span class="attr">android:valueTo</span>=<span class="string">"0.0f"</span></div><div class="line">        <span class="attr">android:valueType</span>=<span class="string">"floatType"</span></div><div class="line">        /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"1000"</span></div><div class="line">        <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></div><div class="line">        <span class="attr">android:valueFrom</span>=<span class="string">"0.0f"</span></div><div class="line">        <span class="attr">android:valueTo</span>=<span class="string">"1.0f"</span></div><div class="line">        <span class="attr">android:valueType</span>=<span class="string">"floatType"</span></div><div class="line">        /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<ol>
<li><code>FloatingActionButton</code>的动画直接定义在java代码中了</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">input.setPivotX(<span class="number">100</span>);<span class="comment">//用ObjectAnimator实现旋转动画时用此方法指定旋转的原点</span></div><div class="line"><span class="keyword">final</span> ObjectAnimator btShow = ObjectAnimator.ofFloat(input, <span class="string">"rotation"</span>, <span class="number">0</span>, <span class="number">180</span>).setDuration(<span class="number">1000</span>);</div><div class="line"><span class="keyword">final</span> ObjectAnimator btHide = ObjectAnimator.ofFloat(input, <span class="string">"rotation"</span>, <span class="number">180</span>, <span class="number">0</span>).setDuration(<span class="number">1000</span>);</div><div class="line">btShow.setInterpolator(<span class="keyword">new</span> OvershootInterpolator());</div><div class="line">btHide.setInterpolator(<span class="keyword">new</span> DecelerateInterpolator());</div></pre></td></tr></table></figure>
<ol>
<li>界面上有<code>EditText</code>所以一打开程序就会把软键盘调出来效果不好，所以在<code>style</code>里加了下面两句：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:configChanges"</span>&gt;</span>keyboardHidden|orientation<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowSoftInputMode"</span>&gt;</span>stateHidden<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div></pre></td></tr></table></figure>
<ol>
<li>要访问网络和读写磁盘，所以加入如下三条权限：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_EXTERNAL_STORAGE"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>/&gt;</span></div></pre></td></tr></table></figure>
<hr>
<center><font size="+2" color="#bbb">源码已上传到GitHub，你可以在这里找到</font></center><br><center><font size="+3"><a href="https://github.com/DuanJiaNing/MultithreadDownload" target="_blank" rel="external">DuanJiaNing/MultithreadDownload</a></font></center>

<p>[^1]: 定义全局的<code>MainActivity.this.file</code>来获得<code>onComplete</code>返回的<code>File</code>引用 或 在此处（<code>onComplete</code>内）定义一个final的File来获得file的引用。<strong>不能使用第二种方法</strong> ——假设使用第二种方法：当第一次下载（<em>打开程序进行的第一次下载任务</em>）成功回调该方法时file被赋值，赋值后dialog初始化，此时dialog持有file的引用，onComplete方法执结束时file被GC回收，但dialog初始时在onclick方法里使用了他的值，使每次调用dialog里onclick方法时使用的file都是第一次调用onComplete时的值，从而使File.reNameTo方法在调用两次之后就出错无法正常重命名。而每次调用editText.setText();时用的却是该次新的final File对象使对话框能正确显示文件名。因此应使用全局的file对象。</p>
<p>[^2]: <code>onComplete</code>方法在<code>DownloadUtil$DownLoadThread</code>中调用（<font size="+2">非<code>UI</code>线程</font>），因此在<code>onComplete</code>中更新UI要使用<code>Handler</code>,<code>Activity.runOnUiThread</code>或<code>View.post</code>。</p>
<center><u><b><em>END</em></b></u></center>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="James Duan" />
          <p class="site-author-name" itemprop="name">James Duan</p>
           
              <p class="site-description motion-element" itemprop="description">￥.￥</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/DuanJiaNing" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/aimeimeits" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-csdn"></i>
                  
                  CSDN
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="aimeimeits@gmail.com" target="_blank" title="Gmail">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Gmail
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/CAFE_BABE_Duan" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="2217611834" target="_blank" title="QQ">
                  
                    <i class="fa fa-fw fa-qq"></i>
                  
                  QQ
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  Thu May 18 2017 08:00:00 GMT+0800 (中国标准时间) - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">James Duan</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
